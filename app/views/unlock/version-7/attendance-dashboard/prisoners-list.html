{% extends "layout_hmpps.html" %}
{% set serviceName = "Activities Management" %}
{% block pageTitle %}
Attendance dashboard
{% endblock %}
{% block primaryNavigation %}
{% endblock %}
{% block beforeContent %}
{{govukBackLink({
text: "Back to attendance daily summary",
"href": "javascript: window.history.go(-1)"
})}}
{% endblock %}
{% block content %}
<h1 class="govuk-heading-xl govuk-!-margin-bottom-5">
	{{pageTitle}}
	<span class="govuk-caption-l">
		{{date|today|convertShortDateToVeryLongDate}}
	</span>
</h1>

<div class="app-search govuk-!-margin-bottom-6">
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-two-thirds">
			<form novalidate="">
				<div class="govuk-form-group">
					<label class="govuk-label app-search__label" for="keywords">
						Search by prisoner name
					</label>
					<input class="govuk-input app-search__input" id="keywords" name="search" type="search"
						value="{{data['search']}}">
				</div>
				<button class="govuk-button app-search__button" data-module="govuk-button">
					Search
				</button>
			</form>
		</div>
	</div>
</div>

<h2 class="govuk-heading-m govuk-!-margin-bottom-2">
	{{attendanceList|length}} {{"person" if attendanceList|length == 1 else "people"}}
</h2>
<table class="govuk-table app-whereabouts-table--font-size-normal app-whereabouts-table--sticky-head"
	data-module="moj-sortable-table">
	<thead class="govuk-table__head">
		<tr class="govuk-table__row">
			<th scope="col" class="govuk-table__header" aria-sort="none">Attendee</th>
			<th scope="col" class="govuk-table__header" aria-sort="none">Session</th>
			<th scope="col" class="govuk-table__header" aria-sort="none">Time recorded</th>
			<th scope="col" class="govuk-table__header" aria-sort="none">Attendance details</th>
			<th scope="col" class="govuk-table__header"></th>
		</tr>
	</thead>
	<tbody class="govuk-table__body">
		{% for prisoner in attendanceList %}
		{% set activity = session.activity|getActivityDetails %}
		<tr class="govuk-table__row">
			<td class="govuk-table__cell">
				{% set prisonerData = prisoner.prisonerId|getPrisonerDetails %}
				<a href="#" class="govuk-link--no-visited-state">
					<b>{{prisonerData.name.surname}}</b>, {{prisonerData.name.firstname}}</a><br>
					<span class="govuk-hint govuk-!-margin-0 govuk-!-font-size-16">{{prisonerData.id}}</span>
			</td>
			<td class="govuk-table__cell">
				{% set activity = prisoner.activityId|getActivityDetails %}
				<a href="#" class="govuk-link--no-visited-state">{{activity.name}}</a>
			</td>
			<td class="govuk-table__cell">
				{{prisoner.attendanceRecord.timestamp.time}} on {{prisoner.attendanceRecord.timestamp.date |
				convertShortDateToMediumDate}}

			</td>
			<td class="govuk-table__cell">
				{% set attendance = prisoner.attendanceRecord.attendance %}
				<ul class="govuk-list govuk-!-margin-0">
					{%- if prisoner.attendanceRecord.attendance == 'attended' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span class="app-tag app-tag--attended"
							style="text-transform: none;">Attended</span></li>
					{%- elif prisoner.attendanceRecord.attendance == 'not-attended' %}
					{%- if prisoner.attendanceRecord.sessionCancelled == true %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span class="app-tag app-tag--cancelled"
							style="text-transform: none;">Session cancelled</span></li>
					{% else %}
					{%- if prisoner.attendanceRecord.attendanceStatus == 'sick' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span
							class="app-tag app-tag--not-attended" style="text-transform: none;">Sick</span></li>
					{% elif prisoner.attendanceRecord.attendanceStatus == 'rest-day' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span
							class="app-tag app-tag--not-attended" style="text-transform: none;">Rest day</span></li>
					{% elif prisoner.attendanceRecord.attendanceStatus == 'not-required' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span
							class="app-tag app-tag--not-attended" style="text-transform: none;">Not required</span></li>
					{% elif prisoner.attendanceRecord.attendanceStatus == 'refused' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span
							class="app-tag app-tag--not-attended" style="text-transform: none;">Refused to attend</span>
					</li>
					{% elif prisoner.attendanceRecord.attendanceStatus == 'other' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span
							class="app-tag app-tag--not-attended" style="text-transform: none;">Absent â€“ other</span>
					</li>
					{% elif prisoner.attendanceRecord.attendanceStatus == 'clash' %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span
							class="app-tag app-tag--not-attended" style="text-transform: none;">Other activity</span>
					</li>
					{% endif -%}
					{% endif -%}
					{%- else %}
					<span class="govuk-hint">Not recorded yet</span>
					{% endif -%}

					{% if prisoner.attendanceRecord.attendance and prisoner.attendanceRecord.pay == true %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span class="app-tag app-tag--pay"
							style="text-transform: none;">Pay</span></li>
					{%- elif prisoner.attendanceRecord.attendance and prisoner.attendanceRecord.pay == false %}
					<li class="govuk-!-display-inline-block govuk-!-margin-0"><span class="app-tag app-tag--no-pay"
							style="text-transform: none;">No pay</span></li>
					{% endif %}
				</ul>
			</td>
			<td class="govuk-table__cell">
				<a href="#" class="govuk-link--no-visited-state">View</a>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
</div>
{% endblock %}