{% extends "layout_hmpps.html" %}
{% set serviceName = "Activities Management" %}
{% block pageTitle %}
Activities Management prototype
{% endblock %}
{% block primaryNavigation %}
{% endblock %}
{% block beforeContent %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{{ govukBreadcrumbs({
	classes: "govuk-!-display-none-print",
	items: [
	{
		text: "Digital Prison Services",
		href: "#"
	},
	{
		text: "Manage prisoner whereabouts",
		href: "whereabouts-concept-2"
	}
	]
}) }}
{% endblock %}
{% block content %}
<div class="govuk-grid-row">
	<div class="govuk-grid-column-three-quarters">
		<h1 class="govuk-heading-xl">
			Houseblock A - All
			<span class="govuk-caption-l">Monday 31st October - PM</span>
		</h1>
	</div>
	<div class="govuk-grid-column-one-quarter">
		<p class="govuk-body" style="text-align: right;">
			⎙ <a href="#">Print this page</a>
		</p>
	</div>
</div>
<div class="govuk-grid-row">
	<div class="govuk-grid-column-one-quarter">
		{%- from "moj/components/filter/macro.njk" import mojFilter -%}
		{%- set filterOptionsHtml %}
<!-- {{ govukInput({
			id: 'keywords',
			name: 'keywords',
			label: {
				text: 'Keywords',
				classes: 'govuk-label--m'
			}
		}) }} -->
		{{ govukCheckboxes({
			idPrefix: 'type',
			name: 'type',
			classes: "govuk-checkboxes--small",
			fieldset: {
				legend: {
					text: 'Activity',
					classes: 'govuk-fieldset__legend--m'
				}
			},
			items: [
			{
				value: '1',
				text: '08:15 - D WING PID FT',
				checked: true
			},
			{
				value: '2',
				text: '08:15 - AM AWAITING ALLOCATION',
				checked: true
			},
			{
				value: '3',
				text: '08:15 - A WING AM CLEANER'
			}
			]
		}) }}
		{{ govukCheckboxes({
			idPrefix: 'status',
			name: 'status',
			classes: "govuk-checkboxes--small",
			fieldset: {
				legend: {
					text: 'Attendance',
					classes: 'govuk-fieldset__legend--m'
				}
			},
			items: [
			{
				value: 'complete',
				text: 'Attended'
			},
			{
				value: 'incomplete',
				text: 'Not attended'
			},
			{
				value: 'inprogress',
				text: 'Unaccounted for',
				checked: true
			}
			]
		}) }}
		{{ govukCheckboxes({
			idPrefix: 'status',
			name: 'status',
			classes: "govuk-checkboxes--small",
			fieldset: {
				legend: {
					text: 'Sub-location',
					classes: 'govuk-fieldset__legend--m'
				}
			},
			items: [
			{
				value: 'complete',
				text: 'Landing 1',
				checked: true
			},
			{
				value: 'incomplete',
				text: 'Landing 2'
			},
			{
				value: 'inprogress',
				text: 'Landing 3',
				checked: false
			}
			]
		}) }}
		{{ govukCheckboxes({
			idPrefix: 'status',
			name: 'status',
			classes: "govuk-checkboxes--small",
			fieldset: {
				legend: {
					text: 'Staying or leaving wing',
					classes: 'govuk-fieldset__legend--m'
				}
			},
			items: [
			{
				value: 'complete',
				text: 'Staying'
			},
			{
				value: 'incomplete',
				text: 'Leaving'
			}
			]
		}) }}
		{% endset -%}
		{{ mojFilter({
			heading: {
				text: 'Filter'
			},
			selectedFilters: {
				heading: {
					text: 'Selected filters'
				},
				clearLink: {
					text: 'Clear filters'
				},
				categories: [
				{
					heading: {
						text: 'Activity'
					},
					items: [{
						href: '/path/to/remove/this',
						text: '08:15 - D WING PID FT'
					}, {
						href: '/path/to/remove/this',
						text: '08:15 - AM AWAITING ALLOCATION'
					}]
				},
				{
					heading: {
						text: 'Status'
					},
					items: [{
						href: '/path/to/remove/this',
						text: 'Unaccounted for'
					}]
				}
				]
			},
			optionsHtml: filterOptionsHtml
		}) }}
	</div>
	<div class="govuk-grid-column-three-quarters">
		<div class="govuk-grid-row">
			<div class="govuk-grid-column-three-quarters">
				<p class="govuk-body-l govuk-!-font-weight-bold">23 prisoners</p>
				<div class="govuk-form-group">
					<label class="govuk-label" name="sort-select">
						Order the list
					</label>
					<select id="sort-select" class="govuk-select">
						<option value="lastName_ASC">Name (A-Z)</option>
						<option value="lastName_DESC">Name (Z-A)</option>
						<option value="cellLocation_ASC">Location (ascending)</option>
						<option value="cellLocation_DESC">Location (descending)</option>
						<option value="activity_ASC">Activity name (A-Z)</option>
						<option value="activity_DESC">Activity name (Z-A)</option>
					</select>
				</div>
			</div>
		</div>
		<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
		<table class="govuk-table app-whereabouts-table">
			<thead class="govuk-table__head">
				<tr>
					<th class="govuk-table__cell">
						<a href="#">Name</a>
					</th>
					<th class="govuk-table__cell">
						<a href="#">Location</a>
					</th>
					<th class="govuk-table__cell">
						Prison number
					</th>
					<th class="govuk-table__cell">
						Relevant alerts
					</th>
					<th class="govuk-table__cell">
						<a href="#">Activities</a>
					</th>
					<th class="govuk-table__cell">
						<a href="#">Other activities</a>
					</th>
					<th class="govuk-table__cell">
						<a href="#">Attendance</a>
					</th>
				</tr>
			</thead>
			<tbody class="govuk-table__body">
				{% for row in range(0, 17) %}
				<tr class="govuk-table__row">
					<td class="govuk-table__cell" width="180">
						<b>Surname</b>, Forename
					</td>
					<td class="govuk-table__cell">
						2-3-014
					</td>
					<td class="govuk-table__cell">
						G9545GV
					</td>
					<td class="govuk-table__cell">
						<div class="alerts"></div>
					</td>
					<td class="govuk-table__cell">
						13:15 - Waste Management PM
					</td>
					<td class="govuk-table__cell">
						<ul></ul>
					</td>
					<td class="govuk-table__cell">
						<a href="#">Record attendance</a>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
		<div class="padding-top">
			<div id="buttons" class="pure-u-md-12-12 padding-bottom">
				<div id="buttons" class="buttons pull-right"><a id="printButton" data-test="print-button" class="sc-bcXHqe sc-ipEyDJ cVsHYs cQzbjF">Print this page</a></div>
			</div>
		</div>
		{% endblock %}
		{% block pageScripts %}
		<script type="text/javascript">
			window.GOVUK = window.GOVUK || {};
			window.GOVUK.Modules = window.GOVUK.Modules || {};

			(function(Modules) {
        /* This JavaScript provides two functional enhancements to option-select components:
          1) A count that shows how many results have been checked in the option-container
          2) Open/closing of the list of checkboxes
          */
          function OptionSelect($module) {
          	this.$optionSelect = $module;
          	this.$options = this.$optionSelect.querySelectorAll(
          		"input[type='checkbox']"
          		);
          	this.$optionsContainer = this.$optionSelect.querySelector(
          		".js-options-container"
          		);
          	this.$optionList = this.$optionsContainer.querySelector(
          		".js-auto-height-inner"
          		);
          	this.$allCheckboxes = this.$optionsContainer.querySelectorAll(
          		".govuk-checkboxes__item"
          		);

          	this.checkedCheckboxes = [];
          }

          OptionSelect.prototype.init = function() {
            // Replace div.container-head with a button
            this.replaceHeadingSpanWithButton();

            // Add js-collapsible class to parent for CSS
            this.$optionSelect.classList.add("js-collapsible");

            // Add open/close listeners
            var button = this.$optionSelect.querySelector(".js-container-button");
            button.addEventListener("click", this.toggleOptionSelect.bind(this));

            var closedOnLoad = this.$optionSelect.getAttribute("data-closed-on-load");
            if (closedOnLoad === "true") {
            	this.close();
            }
        };

        OptionSelect.prototype.cleanString = function cleanString(text) {
        	text = text.replace(/&/g, "and");
            text = text.replace(/[’',:–-]/g, ""); // remove punctuation characters
            text = text.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); // escape special characters
            return text.trim().replace(/\s\s+/g, " ").toLowerCase(); // replace multiple spaces with one
        };

        OptionSelect.prototype.getAllCheckedCheckboxes =
        function getAllCheckedCheckboxes() {
        	this.checkedCheckboxes = [];

        	for (var i = 0; i < this.$options.length; i++) {
        		if (this.$options[i].checked) {
        			this.checkedCheckboxes.push(i);
        		}
        	}
        };

        OptionSelect.prototype.replaceHeadingSpanWithButton =
        function replaceHeadingSpanWithButton() {
                /* Replace the span within the heading with a button element. This is based on feedback from Léonie Watson.
                 * The button has all of the accessibility hooks that are used by screen readers and etc.
                 * We do this in the JavaScript because if the JavaScript is not active then the button shouldn't
                 * be there as there is no JS to handle the click event.
                 */
                 var containerHead = this.$optionSelect.querySelector(
                 	".js-container-button"
                 	);
                 var jsContainerHeadHTML = containerHead.innerHTML;

                // Create button and replace the preexisting html with the button.
                var button = document.createElement("button");
                button.setAttribute(
                	"class",
                	"js-container-button app-c-option-select__title app-c-option-select__button"
                	);
                // Add type button to override default type submit when this component is used within a form
                button.setAttribute("type", "button");
                button.setAttribute("aria-expanded", true);
                button.setAttribute("id", containerHead.getAttribute("id"));
                button.setAttribute(
                	"aria-controls",
                	this.$optionsContainer.getAttribute("id")
                	);
                button.innerHTML = jsContainerHeadHTML;
                containerHead.parentNode.replaceChild(button, containerHead);
            };

            OptionSelect.prototype.toggleOptionSelect = function toggleOptionSelect(e) {
            	if (this.isClosed()) {
            		this.open();
            	} else {
            		this.close();
            	}
            	e.preventDefault();
            };

            OptionSelect.prototype.open = function open() {
            	if (this.isClosed()) {
            		this.$optionSelect
            		.querySelector(".js-container-button")
            		.setAttribute("aria-expanded", true);
            		this.$optionSelect.classList.remove("js-closed");
            		this.$optionSelect.classList.add("js-opened");
            	}
            };

            OptionSelect.prototype.close = function close() {
            	this.$optionSelect.classList.remove("js-opened");
            	this.$optionSelect.classList.add("js-closed");
            	this.$optionSelect
            	.querySelector(".js-container-button")
            	.setAttribute("aria-expanded", false);
            };

            OptionSelect.prototype.isClosed = function isClosed() {
            	return this.$optionSelect.classList.contains("js-closed");
            };

            OptionSelect.prototype.setContainerHeight = function setContainerHeight(
            	height
            	) {
            	this.$optionsContainer.style.height = height + "px";
            };

            OptionSelect.prototype.isCheckboxVisible = function isCheckboxVisible(
            	option
            	) {
            	var initialOptionContainerHeight = this.$optionsContainer.clientHeight;
            	var optionListOffsetTop = this.$optionList.getBoundingClientRect().top;
            	var distanceFromTopOfContainer =
            	option.getBoundingClientRect().top - optionListOffsetTop;
            	return distanceFromTopOfContainer < initialOptionContainerHeight;
            };

            OptionSelect.prototype.getVisibleCheckboxes =
            function getVisibleCheckboxes() {
            	var visibleCheckboxes = [];
            	for (var i = 0; i < this.$options.length; i++) {
            		if (this.isCheckboxVisible(this.$options[i])) {
            			visibleCheckboxes.push(this.$options[i]);
            		}
            	}

                // add an extra checkbox, if the label of the first is too long it collapses onto itself
                if (this.$options[visibleCheckboxes.length]) {
                	visibleCheckboxes.push(this.$options[visibleCheckboxes.length]);
                }
                return visibleCheckboxes;
            };

            Modules.OptionSelect = OptionSelect;
        })(window.GOVUK.Modules);

        var $optionsSelect = document.querySelectorAll('[data-module="option-select"]');
        if ($optionsSelect) {
        	$optionsSelect.forEach((el) =>
        		new window.GOVUK.Modules.OptionSelect(el).init()
        		);
        }
    </script>
    {% endblock%}