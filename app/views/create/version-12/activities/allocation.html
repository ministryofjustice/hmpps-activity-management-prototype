{% extends "layout_hmpps.html" %}
{% block pageTitle %}
Activities Management prototype
{% endblock %}

{% block primaryNavigation %} {% endblock %}

{% block beforeContent %}
{{govukBackLink({
text: "Back to currently allocated",
"href": "../currently-allocated"
})}}
{% endblock %}

{% block content %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% if data['confirmation-dialog'].display == true %}
{% set p = data['confirmation-dialog'].prisoner | getPrisonerDetails %}
{{ govukNotificationBanner({
text: "You have changed the " + data['confirmation-dialog'].change|replace('-',' ') + " for " + p.name.surname + ", " +
p.name.firstname + " (" + p.id + ").",
type: "success"
}) }}
{% endif %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        {% set prisoner = data['new-application']['selected-prisoner']|getPrisonerDetails %}
        <span class="govuk-caption-l">
            {{activity.name}}
        </span>

        <h1 class="govuk-heading-l">
            View or change allocation details for {{prisoner.name.firstname}} {{prisoner.name.surname}} ({{prisoner.id}})
        </h1>

        {% if pastStartDate %}
        <div class="govuk-inset-text">
            You can only change the start date if they have not started this activity.
        </div>
        {% endif %}

        {% if noEndDate %}
        <div class="govuk-inset-text">
            You can only change the end date for people that have been scheduled to be removed from this activity.
        </div>
        {% endif %}

        {% if payRateIsNotSet %}
        <div class="govuk-inset-text">
            You can only change the pay rate for people who have an alternative pay rate.
        </div>
        {% endif %}

        <dl class="govuk-summary-list">
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Prisoner
                </dt>
                <dd class="govuk-summary-list__value">
                    <ul class="govuk-list">
                        <li>
                            {{prisoner.name.firstname}} {{prisoner.name.surname}}
                        </li>
                        <li>
                            {{prisoner.id}}
                        </li>
                        <li>
                            {{prisoner.location.cell}}
                        </li>
                    </ul>
                </dd>
                <dd class="govuk-summary-list__actions">
                    <a href="{{prisoner.id}}/start-date?selected-prisoners={{selectedPrisoners}}"
                        class="govuk-link--no-visited-state">View profile</a>
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Allocation start date
                </dt>
                <dd class="govuk-summary-list__value">
                    {{(prisoner.allocations[prisoner.activityIndex].startDate | convertShortDateToVeryLongDate)
                    if prisoner.allocations[prisoner.activityIndex].startDate else 'None set'}}
                </dd>
                {% if prisoner.startDateIsInFuture %}
                <dd class="govuk-summary-list__actions">
                    <a href="{{prisoner.id}}/start-date?selected-prisoners={{selectedPrisoners}}"
                        class="govuk-link--no-visited-state">Change</a>
                </dd>
                {% endif %}
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Scheduled removal date
                </dt>
                <dd class="govuk-summary-list__value">
                    {{(prisoner.allocations[prisoner.activityIndex].endDate | convertShortDateToVeryLongDate) if
                    prisoner.allocations[prisoner.activityIndex].endDate else 'None set'}}
                </dd>
                <dd class="govuk-summary-list__actions">
                    <ul class="govuk-summary-list__actions-list">
                        {% if prisoner.allocations[prisoner.activityIndex].endDate %}
                        <li class="govuk-summary-list__actions-list-item">
                            <a href="{{prisoner.id}}/remove-end-date?selected-prisoners={{selectedPrisoners}}"
                                class="govuk-link--no-visited-state">Remove</a>
                        </li>
                        {% endif %}
                    </ul>
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Pay rate
                </dt>
                <dd class="govuk-summary-list__value">
                    {{prisoner.payrate or "General - Â£1.00"}}
                </dd>
                <dd class="govuk-summary-list__actions">
                    <a href="{{prisoner.id}}/payrate?selected-prisoners={{selectedPrisoners}}"
                        class="govuk-link--no-visited-state">Change</a>
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Non-associations
                </dt>
                <dd class="govuk-summary-list__value">
                    None
                </dd>
            </div>
        </dl>

        {{ govukButton({
        text: "Remove from activity",
        classes: "govuk-button--warning",
        href: "../deallocate/" + prisoner.id
        }) }}
    </div>
</div>

{% endblock %}